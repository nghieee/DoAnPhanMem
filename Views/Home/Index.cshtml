@{
    ViewData["Title"] = "Home Page";
}

<style>
    .product-slide .card-text {
        height: 42px;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .product-slide .card-title {
        height: 72px;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .cart-detail .cart-name {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis;
    }
</style>

<div class="main__slider">
    <div id="carouselExampleAutoplaying" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-inner">
            <div class="carousel-item active">
                <img class="d-block w-100" alt="" src="~/img/home-banner.png" />
            </div>
            <div class="carousel-item">
                <img class="d-block w-100" alt="" src="~/img/home-banner2.png" />
            </div>
            <div class="carousel-item">
                <img class="d-block w-100" alt="" src="~/img/home-banner3.png" />
            </div>
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleAutoplaying" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleAutoplaying" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
        </button>
    </div>
    <div class="main__product container pt-5 pb-5">
        <h2 class="text-uppercase fw-500 text-center font-serif pt-5 p-4">Top sản phẩm bán chạy</h2>
        <div class="product-slide row row-cols-4">
            <div class="product col">
                <div class="card border-0">
                    <img src="~/img/sanpham2.png" class="card-img-top" alt="" />
                    <div class="card-body text-center">
                        <h5 class="card-title fw-bold font-serif">Sữa Rửa Mặt Hoa Cúc Kiehl's Calendula Deep Cleansing Foaming Face Wash</h5>
                        <p class="card-text fst-italic font-14 font-serif">Sữa rửa mặt tạo bọt, giúp làm sạch sâu hiệu quả mà không gây khô da, đồng thời cung cấp các dưỡng chất cần thiết và làm dịu da.</p>
                    </div>
                    <div class="form-group d-flex justify-content-center align-items-center">
                        <label for="dropdownMenu1" class="font-12 me-2">Chọn dung tích:</label>
                        <select id="dropdownMenu1" class="dropdownMenu form-control w-50">
                            <option value="75ml" data-price="550000" data-size="75ml" selected>75ml</option>
                            <option value="230ml" data-price="1000000" data-size="230ml">230ml</option>
                            <option value="500ml" data-price="1800000" data-size="500ml">500ml</option>
                        </select>
                    </div>
                    <div class="font-18 text-center fw-500 pt-2 pb-2">
                        <span class="priceDisplay">550.000đ</span>
                    </div>
                    <button type="button" class="btn btn-outline-dark add-to-cart" data-name="Sữa Rửa Mặt Hoa Cúc Kiehl's Calendula Deep Cleansing Foaming Face Wash" data-price="550000" data-size="75ml">THÊM VÀO GIỎ HÀNG</button>
                </div>
            </div>
            <div class="product col">
                <div class="card border-0">
                    <img src="~/img/sanpham2.png" class="card-img-top" alt="" />
                    <div class="card-body text-center">
                        <h5 class="card-title fw-bold font-serif">Sữa Rửa Mặt Hoa Cúc Kiehl's Calendula Deep Cleansing Foaming Face Wash</h5>
                        <p class="card-text fst-italic font-14 font-serif">Sữa rửa mặt tạo bọt, giúp làm sạch sâu hiệu quả mà không gây khô da, đồng thời cung cấp các dưỡng chất cần thiết và làm dịu da.</p>
                    </div>
                    <div class="form-group d-flex justify-content-center align-items-center">
                        <label for="dropdownMenu1" class="font-12 me-2">Chọn dung tích:</label>
                        <select id="dropdownMenu1" class="dropdownMenu form-control w-50">
                            <option value="75ml" data-price="550000" data-size="75ml" selected>75ml</option>
                            <option value="230ml" data-price="1000000" data-size="230ml">230ml</option>
                            <option value="500ml" data-price="1800000" data-size="500ml">500ml</option>
                        </select>
                    </div>
                    <div class="font-18 text-center fw-500 pt-2 pb-2">
                        <span class="priceDisplay">550.000đ</span>
                    </div>
                    <button type="button" class="btn btn-outline-dark add-to-cart" data-name="Sữa Rửa Mặt Hoa Cúc Kiehl's" data-price="550000" data-size="75ml">THÊM VÀO GIỎ HÀNG</button>
                </div>
            </div>

        </div>
    </div>
</div>

<script>
    let cart = JSON.parse(localStorage.getItem('cart')) || [];

    function updateCartDisplay() {
        const cartContent = document.querySelector('.cart-content');
        const cartCount = document.querySelector('.cart-count');
        const totalPriceDisplay = document.querySelector('.total-price');
        const cartEmptyMessage = document.querySelector('.cart-empty');

        cartContent.innerHTML = ''; 
        cartCount.textContent = cart.length; 

        if (cart.length === 0) {
            cartEmptyMessage.classList.remove('d-none'); 
            totalPriceDisplay.textContent = '0';
            return;
        } else {
            cartEmptyMessage.classList.add('d-none');
        }

        cart.forEach((item, index) => {
            const cartItem = document.createElement('div');
            cartItem.className = 'cart-item col d-flex pt-3 pb-3 mb-3 border border-1';
            cartItem.innerHTML = `
                    <img src="~/img/sanpham2.png" style="width: 70px; height: 70px;" />
                    <div class="cart-detail w-100 ps-2 text-start">
                        <h6 class="cart-name font-serif">${item.name}</h6>
                        <span class="font-12 font-serif">${item.size}</span>
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="quantity">
                                <input type="number" id="quantityInput${index}" value="${item.quantity}" min="1" max="10" data-price="${item.price}">
                            </div>
                            <div class="font-14 text-center fw-500">
                                <span id="priceDisplay${index}">${(item.price * item.quantity).toLocaleString()}đ</span>
                            </div>
                        </div>
                    </div>
                    <button class="close-cart border-0 bg-white" style="height: fit-content; margin-top: -16px;" data-index="${index}">
                        <i class="fa-solid fa-xmark" style="font-size: 12px;" aria-hidden="true"></i>
                    </button>
                `;

            cartContent.appendChild(cartItem);

            //Xóa sp khỏi giỏ hàng
            const removeButton = cartItem.querySelector('.close-cart');
            removeButton.addEventListener('click', function () {
                cart.splice(index, 1); 
                updateCartDisplay(); 
                localStorage.setItem('cart', JSON.stringify(cart)); 
            });

            //Thay đổi sl sp
            const quantityInput = cartItem.querySelector(`#quantityInput${index}`);
            quantityInput.addEventListener('change', function () {
                item.quantity = parseInt(this.value); 
                const priceDisplay = cartItem.querySelector(`#priceDisplay${index}`);
                priceDisplay.textContent = (item.price * item.quantity).toLocaleString('vi-VN') + 'đ';
                updateTotalPrice(); 
                localStorage.setItem('cart', JSON.stringify(cart)); 
            });
        });

        updateTotalPrice(); 
    }

    //Cập nhật tổng tiền
    function updateTotalPrice() {
        let totalPrice = 0;
        cart.forEach(item => {
            totalPrice += item.price * item.quantity;
        });
        const totalPriceDisplay = document.querySelector('.total-price');
        totalPriceDisplay.textContent = totalPrice.toLocaleString('vi-VN') + 'đ';
    }

    //Xử lý nút thêm sp
    document.querySelectorAll('.add-to-cart').forEach(button => {
        button.addEventListener('click', function () {
            const card = this.closest('.card');
            const productName = this.getAttribute('data-name').trim();
            const productSize = card.querySelector('.dropdownMenu').value.trim();
            const productPrice = parseInt(card.querySelector('.dropdownMenu').selectedOptions[0].getAttribute('data-price'));

            const product = {
                name: productName,
                size: productSize,
                price: productPrice,
                quantity: 1
            };

            const existingProductIndex = cart.findIndex(item =>
                item.name === product.name && item.size === product.size
            );

            if (existingProductIndex >= 0) {
                cart[existingProductIndex].quantity += 1;
            } else {
                cart.push(product);
            }

            localStorage.setItem('cart', JSON.stringify(cart));

            showAlert(`Đã thêm ${productName} - ${productSize} vào giỏ hàng`);

            updateCartDisplay();
        });
    });

    function showAlert(message) {
        const alertDiv = document.createElement('div');
        alertDiv.textContent = message;
        alertDiv.style.position = 'fixed';
        alertDiv.style.top = '20px';
        alertDiv.style.right = '20px';
        alertDiv.style.backgroundColor = 'green';
        alertDiv.style.color = 'white';
        alertDiv.style.padding = '10px';
        alertDiv.style.borderRadius = '5px';
        document.body.appendChild(alertDiv);

        setTimeout(function () {
            alertDiv.remove();
        }, 3000);
    }

    document.addEventListener('DOMContentLoaded', function () {
        updateCartDisplay(); 
    });
</script>

